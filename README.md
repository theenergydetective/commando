
# TED Commando  
TED Commando is a simple web server application to allow TED 5000, TED Home, and TED Pro systmes to post energy data that can be exported.  
  
## Installation  

### Digital Ocean

## Manually Running (Desktop)  
  
### Prerequisites  
 - OpenJDK 11+ (https://https://openjdk.java.net/)
  
### Windows  
- Download commando-1.0.jar   
- Create the following directories on the same drive as <i>commando-1.0.jar</i>
	**_`/opt/data`_**
	 **_`/var/log`_**  
  
- From the directory that contains <i>commando-1.0.jar</i>, start the application using the following command:
**_`java -jar commando-1.0.jar -Dspring.datasource.url=jdbc:h2:file:C:/opt/data/commando`_**  
  
- Configure the application server by going to the URL: http://<ip of server>:8080   e.g. http://192.168.10.10:8080

### LINUX  
- Download commando-1.0.jar   
- Create the directory: **_`/opt/data`_**
- From the directory that contains <i>commando-1.0.jar</i>, start the application using the following command:
**_`sudo ./commando-1.0.jar`_**  
- Configure the application server by going to the URL: http://<ip of server>:8080   e.g. http://192.168.10.10:8080

### TLS Support
By default the server does not use TLS to encrypt data. To encrypt data, we suggest using <a href="https://httpd.apache.org/">Apache HTTP2</a> and a free certificate generated by <a href="[https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-18-04](https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-18-04)">LetsEncrypt</a>.  <b>NOTE:</b> The TED devices are NOT able to post using TLS. You will need to allow them to post over a standard HTTP connection. Therefore, you should not select the option to automatically redirect traffic from HTTP to HTTPS . 

#### ProxyPass
In order to allow Apache Traffic to route traffic to the <i>Commando</i> server, you will need to set up ProxyPass to allow the traffic to be pass through.  Add these lines to your apache2.conf or virtual domain site file. 

    ProxyRequests Off
    ProxyPreserveHost On
    ProxyPass /api/ http://localhost:8080/api/ retry=0
    ProxyPassReverse /api/ http://localhost:8080/api/
    ProxyPass /oauth/ http://localhost:8080/oauth/ retry=0
    ProxyPassReverse /oauth/ http://localhost:8080/oauth/



### Command Line Options  

#### Database Path
To change the path of the database, use this option:   **_`-Dspring.datasource.url=jdbc:h2:file:<path to database>`_**   Remember, that the drive letter needs to be included if running in a windows environment.  This parameter is <b>REQUIRED</b> if running under Windows.
e.g. **_`-Dspring.datasource.url=jdbc:h2:file:C:/opt/data/commando`_**  
  
For Linux/MacOS the drive name is not required  and the this command line option is optional
e.g. **_`-Dspring.datasource.url=jdbc:h2:file:/opt/data/commando`_**  

#### Default  Port
By default, the server will operate under port 8080. To change the default port, use the following option:
  **_`-Dserver.port=<port>`_** e.g.   **_`-Dserver.port=80`_** to run the port over standard http.
  
  
## Developer Notes  
  
### License  
  
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0  
   
 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.  
  
  
### Prerequisites  
- Nodejs (https://nodejs.org) - This was originally build using 12.16.3LTS but new versions should be fine.  
- Angular CLI (https://angular.io/guide/setup-local)  
- OpenJDK 11+ (https://https://openjdk.java.net/)  
  
### Windows Notes  
  
- If developing on Windows, you must pass the following property as a VM option as H2 requires and absolute path.  
  
**_`-Dspring.datasource.url=jdbc:h2:file:C:/opt/data/commando`_**  
  
- If using WSL for Angular/Node, then the maven command line must be run from there as well.  
   
  
### How to Build  
- Clone or download the source code and extract it.  
- Start in the root Commando directory (same directory as pom.xml)  
- Be sure all of the pre-requisits are installed.  
- After node is installed, run **_`npm install`_** from the **_`commando/src/main/resources/frontend/command-app`_** directory.  
- Run the following from the command prompt: **_` mvn clean package install -DskipTests `_**